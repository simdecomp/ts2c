.include "macros.inc"

.section .text, "ax"  # 0x80006940 - 0x80418B80
.global "DSPCheckMailToDSP"
"DSPCheckMailToDSP":
/* 80368E20 00364AC0  3C 60 CC 00 */	lis r3, 0xCC005000@ha
/* 80368E24 00364AC4  A0 03 50 00 */	lhz r0, 0xCC005000@l(r3)
/* 80368E28 00364AC8  54 03 8F FE */	rlwinm r3, r0, 0x11, 0x1f, 0x1f
/* 80368E2C 00364ACC  4E 80 00 20 */	blr

.global "DSPCheckMailFromDSP"
"DSPCheckMailFromDSP":
/* 80368E30 00364AD0  3C 60 CC 00 */	lis r3, 0xCC005004@ha
/* 80368E34 00364AD4  A0 03 50 04 */	lhz r0, 0xCC005004@l(r3)
/* 80368E38 00364AD8  54 03 8F FE */	rlwinm r3, r0, 0x11, 0x1f, 0x1f
/* 80368E3C 00364ADC  4E 80 00 20 */	blr

.global "DSPReadMailFromDSP"
"DSPReadMailFromDSP":
/* 80368E40 00364AE0  3C 60 CC 00 */	lis r3, 0xCC005004@ha
/* 80368E44 00364AE4  A0 03 50 04 */	lhz r0, 0xCC005004@l(r3)
/* 80368E48 00364AE8  A0 63 50 06 */	lhz r3, 0x5006(r3)
/* 80368E4C 00364AEC  50 03 80 1E */	rlwimi r3, r0, 0x10, 0, 0xf
/* 80368E50 00364AF0  4E 80 00 20 */	blr

.global "DSPSendMailToDSP"
"DSPSendMailToDSP":
/* 80368E54 00364AF4  3C 80 CC 00 */	lis r4, 0xCC005000@ha
/* 80368E58 00364AF8  54 60 84 3E */	srwi r0, r3, 0x10
/* 80368E5C 00364AFC  B0 04 50 00 */	sth r0, 0xCC005000@l(r4)
/* 80368E60 00364B00  B0 64 50 02 */	sth r3, 0x5002(r4)
/* 80368E64 00364B04  4E 80 00 20 */	blr

.global "DSPInit"
"DSPInit":
/* 80368E68 00364B08  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 80368E6C 00364B0C  7C 08 02 A6 */	mflr r0
/* 80368E70 00364B10  3C A0 80 46 */	lis r5, lbl_80466160@ha
/* 80368E74 00364B14  90 01 00 14 */	stw r0, 0x14(r1)
/* 80368E78 00364B18  38 A5 61 60 */	addi r5, r5, lbl_80466160@l
/* 80368E7C 00364B1C  38 65 00 48 */	addi r3, r5, 0x48
/* 80368E80 00364B20  93 E1 00 0C */	stw r31, 0xc(r1)
/* 80368E84 00364B24  38 85 00 68 */	addi r4, r5, 0x68
/* 80368E88 00364B28  38 A5 00 74 */	addi r5, r5, 0x74
/* 80368E8C 00364B2C  4C C6 31 82 */	crclr 6
/* 80368E90 00364B30  48 00 02 0D */	bl "__DSP_debug_printf"
/* 80368E94 00364B34  80 0D C3 60 */	lwz r0, "__DSP_init_flag"-_SDA_BASE_(r13)
/* 80368E98 00364B38  2C 00 00 01 */	cmpwi r0, 1
/* 80368E9C 00364B3C  41 82 00 78 */	beq lbl_80368F14
/* 80368EA0 00364B40  80 6D AC 28 */	lwz r3, "__DSPVersion"-_SDA_BASE_(r13)
/* 80368EA4 00364B44  48 07 23 C9 */	bl "OSRegisterVersion"
/* 80368EA8 00364B48  48 07 75 B5 */	bl "__RAS_OSDisableInterrupts_begin"
/* 80368EAC 00364B4C  3C 80 80 37 */	lis r4, "__DSPHandler"@ha
/* 80368EB0 00364B50  7C 7F 1B 78 */	mr r31, r3
/* 80368EB4 00364B54  38 84 90 EC */	addi r4, r4, "__DSPHandler"@l
/* 80368EB8 00364B58  38 60 00 07 */	li r3, 7
/* 80368EBC 00364B5C  48 07 75 ED */	bl "__OSSetInterruptHandler"
/* 80368EC0 00364B60  3C 60 01 00 */	lis r3, 0x100
/* 80368EC4 00364B64  48 07 79 A9 */	bl "__OSUnmaskInterrupts"
/* 80368EC8 00364B68  3C E0 CC 00 */	lis r7, 0xCC00500A@ha
/* 80368ECC 00364B6C  38 60 FF 57 */	li r3, -169
/* 80368ED0 00364B70  A0 C7 50 0A */	lhz r6, 0xCC00500A@l(r7)
/* 80368ED4 00364B74  38 A0 FF 53 */	li r5, -173
/* 80368ED8 00364B78  38 80 00 00 */	li r4, 0
/* 80368EDC 00364B7C  38 00 00 01 */	li r0, 1
/* 80368EE0 00364B80  7C C3 18 38 */	and r3, r6, r3
/* 80368EE4 00364B84  60 63 08 00 */	ori r3, r3, 0x800
/* 80368EE8 00364B88  B0 67 50 0A */	sth r3, 0x500a(r7)
/* 80368EEC 00364B8C  7F E3 FB 78 */	mr r3, r31
/* 80368EF0 00364B90  A0 C7 50 0A */	lhz r6, 0x500a(r7)
/* 80368EF4 00364B94  7C C5 28 38 */	and r5, r6, r5
/* 80368EF8 00364B98  B0 A7 50 0A */	sth r5, 0x500a(r7)
/* 80368EFC 00364B9C  90 8D C3 70 */	stw r4, "__DSP_tmp_task"-_SDA_BASE_(r13)
/* 80368F00 00364BA0  90 8D C3 7C */	stw r4, "__DSP_curr_task"-_SDA_BASE_(r13)
/* 80368F04 00364BA4  90 8D C3 74 */	stw r4, "__DSP_last_task"-_SDA_BASE_(r13)
/* 80368F08 00364BA8  90 8D C3 78 */	stw r4, "__DSP_first_task"-_SDA_BASE_(r13)
/* 80368F0C 00364BAC  90 0D C3 60 */	stw r0, "__DSP_init_flag"-_SDA_BASE_(r13)
/* 80368F10 00364BB0  48 07 75 75 */	bl "OSRestoreInterrupts"
lbl_80368F14:
/* 80368F14 00364BB4  80 01 00 14 */	lwz r0, 0x14(r1)
/* 80368F18 00364BB8  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 80368F1C 00364BBC  7C 08 03 A6 */	mtlr r0
/* 80368F20 00364BC0  38 21 00 10 */	addi r1, r1, 0x10
/* 80368F24 00364BC4  4E 80 00 20 */	blr

.global "DSPCheckInit"
"DSPCheckInit":
/* 80368F28 00364BC8  80 6D C3 60 */	lwz r3, "__DSP_init_flag"-_SDA_BASE_(r13)
/* 80368F2C 00364BCC  4E 80 00 20 */	blr

.global "DSPAddTask"
"DSPAddTask":
/* 80368F30 00364BD0  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 80368F34 00364BD4  7C 08 02 A6 */	mflr r0
/* 80368F38 00364BD8  90 01 00 14 */	stw r0, 0x14(r1)
/* 80368F3C 00364BDC  93 E1 00 0C */	stw r31, 0xc(r1)
/* 80368F40 00364BE0  93 C1 00 08 */	stw r30, 8(r1)
/* 80368F44 00364BE4  7C 7E 1B 78 */	mr r30, r3
/* 80368F48 00364BE8  48 07 75 15 */	bl "__RAS_OSDisableInterrupts_begin"
/* 80368F4C 00364BEC  7C 7F 1B 78 */	mr r31, r3
/* 80368F50 00364BF0  7F C3 F3 78 */	mr r3, r30
/* 80368F54 00364BF4  48 00 08 FD */	bl "__DSP_insert_task"
/* 80368F58 00364BF8  38 60 00 00 */	li r3, 0
/* 80368F5C 00364BFC  38 00 00 01 */	li r0, 1
/* 80368F60 00364C00  90 7E 00 00 */	stw r3, 0(r30)
/* 80368F64 00364C04  7F E3 FB 78 */	mr r3, r31
/* 80368F68 00364C08  90 1E 00 08 */	stw r0, 8(r30)
/* 80368F6C 00364C0C  48 07 75 19 */	bl "OSRestoreInterrupts"
/* 80368F70 00364C10  80 0D C3 78 */	lwz r0, "__DSP_first_task"-_SDA_BASE_(r13)
/* 80368F74 00364C14  7C 1E 00 40 */	cmplw r30, r0
/* 80368F78 00364C18  40 82 00 0C */	bne lbl_80368F84
/* 80368F7C 00364C1C  7F C3 F3 78 */	mr r3, r30
/* 80368F80 00364C20  48 00 07 45 */	bl "__DSP_boot_task"
lbl_80368F84:
/* 80368F84 00364C24  7F C3 F3 78 */	mr r3, r30
/* 80368F88 00364C28  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 80368F8C 00364C2C  83 C1 00 08 */	lwz r30, 8(r1)
/* 80368F90 00364C30  80 01 00 14 */	lwz r0, 0x14(r1)
/* 80368F94 00364C34  7C 08 03 A6 */	mtlr r0
/* 80368F98 00364C38  38 21 00 10 */	addi r1, r1, 0x10
/* 80368F9C 00364C3C  4E 80 00 20 */	blr

.global "DSPCancelTask"
"DSPCancelTask":
/* 80368FA0 00364C40  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 80368FA4 00364C44  7C 08 02 A6 */	mflr r0
/* 80368FA8 00364C48  90 01 00 14 */	stw r0, 0x14(r1)
/* 80368FAC 00364C4C  93 E1 00 0C */	stw r31, 0xc(r1)
/* 80368FB0 00364C50  7C 7F 1B 78 */	mr r31, r3
/* 80368FB4 00364C54  48 07 74 A9 */	bl "__RAS_OSDisableInterrupts_begin"
/* 80368FB8 00364C58  80 1F 00 08 */	lwz r0, 8(r31)
/* 80368FBC 00364C5C  60 00 00 02 */	ori r0, r0, 2
/* 80368FC0 00364C60  90 1F 00 08 */	stw r0, 8(r31)
/* 80368FC4 00364C64  48 07 74 C1 */	bl "OSRestoreInterrupts"
/* 80368FC8 00364C68  7F E3 FB 78 */	mr r3, r31
/* 80368FCC 00364C6C  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 80368FD0 00364C70  80 01 00 14 */	lwz r0, 0x14(r1)
/* 80368FD4 00364C74  7C 08 03 A6 */	mtlr r0
/* 80368FD8 00364C78  38 21 00 10 */	addi r1, r1, 0x10
/* 80368FDC 00364C7C  4E 80 00 20 */	blr

.global "DSPAssertTask"
"DSPAssertTask":
/* 80368FE0 00364C80  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 80368FE4 00364C84  7C 08 02 A6 */	mflr r0
/* 80368FE8 00364C88  90 01 00 14 */	stw r0, 0x14(r1)
/* 80368FEC 00364C8C  93 E1 00 0C */	stw r31, 0xc(r1)
/* 80368FF0 00364C90  93 C1 00 08 */	stw r30, 8(r1)
/* 80368FF4 00364C94  7C 7E 1B 78 */	mr r30, r3
/* 80368FF8 00364C98  48 07 74 65 */	bl "__RAS_OSDisableInterrupts_begin"
/* 80368FFC 00364C9C  80 AD C3 7C */	lwz r5, "__DSP_curr_task"-_SDA_BASE_(r13)
/* 80369000 00364CA0  7C 7F 1B 78 */	mr r31, r3
/* 80369004 00364CA4  7C 05 F0 40 */	cmplw r5, r30
/* 80369008 00364CA8  40 82 00 1C */	bne lbl_80369024
/* 8036900C 00364CAC  38 00 00 01 */	li r0, 1
/* 80369010 00364CB0  93 CD C3 6C */	stw r30, "__DSP_rude_task"-_SDA_BASE_(r13)
/* 80369014 00364CB4  90 0D C3 68 */	stw r0, "__DSP_rude_task_pending"-_SDA_BASE_(r13)
/* 80369018 00364CB8  48 07 74 6D */	bl "OSRestoreInterrupts"
/* 8036901C 00364CBC  7F C3 F3 78 */	mr r3, r30
/* 80369020 00364CC0  48 00 00 64 */	b lbl_80369084
lbl_80369024:
/* 80369024 00364CC4  80 9E 00 04 */	lwz r4, 4(r30)
/* 80369028 00364CC8  80 05 00 04 */	lwz r0, 4(r5)
/* 8036902C 00364CCC  7C 04 00 40 */	cmplw r4, r0
/* 80369030 00364CD0  40 80 00 4C */	bge lbl_8036907C
/* 80369034 00364CD4  38 00 00 01 */	li r0, 1
/* 80369038 00364CD8  93 CD C3 6C */	stw r30, "__DSP_rude_task"-_SDA_BASE_(r13)
/* 8036903C 00364CDC  90 0D C3 68 */	stw r0, "__DSP_rude_task_pending"-_SDA_BASE_(r13)
/* 80369040 00364CE0  80 05 00 00 */	lwz r0, 0(r5)
/* 80369044 00364CE4  28 00 00 01 */	cmplwi r0, 1
/* 80369048 00364CE8  40 82 00 24 */	bne lbl_8036906C
/* 8036904C 00364CEC  48 07 74 11 */	bl "__RAS_OSDisableInterrupts_begin"
/* 80369050 00364CF0  3C A0 CC 00 */	lis r5, 0xCC00500A@ha
/* 80369054 00364CF4  38 00 FF 57 */	li r0, -169
/* 80369058 00364CF8  A0 85 50 0A */	lhz r4, 0xCC00500A@l(r5)
/* 8036905C 00364CFC  7C 80 00 38 */	and r0, r4, r0
/* 80369060 00364D00  60 00 00 02 */	ori r0, r0, 2
/* 80369064 00364D04  B0 05 50 0A */	sth r0, 0x500a(r5)
/* 80369068 00364D08  48 07 74 1D */	bl "OSRestoreInterrupts"
lbl_8036906C:
/* 8036906C 00364D0C  7F E3 FB 78 */	mr r3, r31
/* 80369070 00364D10  48 07 74 15 */	bl "OSRestoreInterrupts"
/* 80369074 00364D14  7F C3 F3 78 */	mr r3, r30
/* 80369078 00364D18  48 00 00 0C */	b lbl_80369084
lbl_8036907C:
/* 8036907C 00364D1C  48 07 74 09 */	bl "OSRestoreInterrupts"
/* 80369080 00364D20  38 60 00 00 */	li r3, 0
lbl_80369084:
/* 80369084 00364D24  80 01 00 14 */	lwz r0, 0x14(r1)
/* 80369088 00364D28  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 8036908C 00364D2C  83 C1 00 08 */	lwz r30, 8(r1)
/* 80369090 00364D30  7C 08 03 A6 */	mtlr r0
/* 80369094 00364D34  38 21 00 10 */	addi r1, r1, 0x10
/* 80369098 00364D38  4E 80 00 20 */	blr

.section .data, "wa"  # 0x80420060 - 0x80488160
.global lbl_80466160
lbl_80466160:
	# ROM: 0x462260
	.asciz "<< RVL_SDK - DSP \trelease build: Nov 30 2006 03:26:46 (0x4199_60831) >>"
	.asciz "DSPInit(): Build Date: %s %s\n"
	.byte 0x00, 0x00
	.asciz "Nov 30 2006"
	.asciz "03:26:46"
	.byte 0x00, 0x00, 0x00


.section .sdata, "wa"  # 0x805D46E0 - 0x805D79C0
.global "__DSPVersion"
"__DSPVersion":
	# ROM: 0x486E88
	.4byte 0x80466160 ;# ptr
	.4byte 0x00000000


.section .sbss, "wa"  # 0x805d79c0 - 0x805d9220
.global "__DSP_init_flag"
"__DSP_init_flag":
	.skip 0x8
