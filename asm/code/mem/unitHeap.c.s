.include "macros.inc"

.section .text, "ax"  # 0x80006940 - 0x80418B80
.global "MEMCreateUnitHeapEx"
"MEMCreateUnitHeapEx":
/* 803D3BCC 003CF86C  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 803D3BD0 003CF870  7C 08 02 A6 */	mflr r0
/* 803D3BD4 003CF874  90 01 00 24 */	stw r0, 0x24(r1)
/* 803D3BD8 003CF878  39 61 00 20 */	addi r11, r1, 0x20
/* 803D3BDC 003CF87C  48 03 B7 99 */	bl "_savegpr_27"
/* 803D3BE0 003CF880  39 03 00 03 */	addi r8, r3, 3
/* 803D3BE4 003CF884  7C 04 1A 14 */	add r0, r4, r3
/* 803D3BE8 003CF888  55 1F 00 3A */	rlwinm r31, r8, 0, 0, 0x1d
/* 803D3BEC 003CF88C  54 08 00 3A */	rlwinm r8, r0, 0, 0, 0x1d
/* 803D3BF0 003CF890  7C 08 F8 51 */	subf. r0, r8, r31
/* 803D3BF4 003CF894  40 81 00 0C */	ble lbl_803D3C00
/* 803D3BF8 003CF898  38 60 00 00 */	li r3, 0
/* 803D3BFC 003CF89C  48 00 01 14 */	b lbl_803D3D10
lbl_803D3C00:
/* 803D3C00 003CF8A0  3B DF 00 3C */	addi r30, r31, 0x3c
/* 803D3C04 003CF8A4  38 06 FF FF */	addi r0, r6, -1
/* 803D3C08 003CF8A8  7C 7E 32 14 */	add r3, r30, r6
/* 803D3C0C 003CF8AC  7C 86 2A 14 */	add r4, r6, r5
/* 803D3C10 003CF8B0  7C 05 00 F8 */	nor r5, r0, r0
/* 803D3C14 003CF8B4  38 03 00 07 */	addi r0, r3, 7
/* 803D3C18 003CF8B8  38 64 FF FF */	addi r3, r4, -1
/* 803D3C1C 003CF8BC  7C BC 00 38 */	and r28, r5, r0
/* 803D3C20 003CF8C0  7C 08 E0 51 */	subf. r0, r8, r28
/* 803D3C24 003CF8C4  7C BB 18 38 */	and r27, r5, r3
/* 803D3C28 003CF8C8  40 81 00 0C */	ble lbl_803D3C34
/* 803D3C2C 003CF8CC  38 60 00 00 */	li r3, 0
/* 803D3C30 003CF8D0  48 00 00 E0 */	b lbl_803D3D10
lbl_803D3C34:
/* 803D3C34 003CF8D4  7C 1C 40 50 */	subf r0, r28, r8
/* 803D3C38 003CF8D8  7F A0 DB 97 */	divwu. r29, r0, r27
/* 803D3C3C 003CF8DC  40 82 00 0C */	bne lbl_803D3C48
/* 803D3C40 003CF8E0  38 60 00 00 */	li r3, 0
/* 803D3C44 003CF8E4  48 00 00 CC */	b lbl_803D3D10
lbl_803D3C48:
/* 803D3C48 003CF8E8  7C 1D D9 D6 */	mullw r0, r29, r27
/* 803D3C4C 003CF8EC  3C 80 55 4E */	lis r4, 0x554E5448@ha
/* 803D3C50 003CF8F0  7F E3 FB 78 */	mr r3, r31
/* 803D3C54 003CF8F4  7F 85 E3 78 */	mr r5, r28
/* 803D3C58 003CF8F8  38 84 54 48 */	addi r4, r4, 0x554E5448@l
/* 803D3C5C 003CF8FC  7C C0 E2 14 */	add r6, r0, r28
/* 803D3C60 003CF900  4B FF F1 E9 */	bl "MEMiInitHeapHead"
/* 803D3C64 003CF904  38 7D FF FF */	addi r3, r29, -1
/* 803D3C68 003CF908  93 9E 00 00 */	stw r28, 0(r30)
/* 803D3C6C 003CF90C  28 03 00 00 */	cmplwi r3, 0
/* 803D3C70 003CF910  93 7E 00 04 */	stw r27, 4(r30)
/* 803D3C74 003CF914  40 81 00 90 */	ble lbl_803D3D04
/* 803D3C78 003CF918  54 60 E8 FF */	rlwinm. r0, r3, 0x1d, 3, 0x1f
/* 803D3C7C 003CF91C  7C 09 03 A6 */	mtctr r0
/* 803D3C80 003CF920  41 82 00 70 */	beq lbl_803D3CF0
lbl_803D3C84:
/* 803D3C84 003CF924  7C 1B E2 14 */	add r0, r27, r28
/* 803D3C88 003CF928  90 1C 00 00 */	stw r0, 0(r28)
/* 803D3C8C 003CF92C  7C 1C 03 78 */	mr r28, r0
/* 803D3C90 003CF930  7C 1B 02 14 */	add r0, r27, r0
/* 803D3C94 003CF934  90 1C 00 00 */	stw r0, 0(r28)
/* 803D3C98 003CF938  7C 1C 03 78 */	mr r28, r0
/* 803D3C9C 003CF93C  7C 1B 02 14 */	add r0, r27, r0
/* 803D3CA0 003CF940  90 1C 00 00 */	stw r0, 0(r28)
/* 803D3CA4 003CF944  7C 1C 03 78 */	mr r28, r0
/* 803D3CA8 003CF948  7C 1B 02 14 */	add r0, r27, r0
/* 803D3CAC 003CF94C  90 1C 00 00 */	stw r0, 0(r28)
/* 803D3CB0 003CF950  7C 1C 03 78 */	mr r28, r0
/* 803D3CB4 003CF954  7C 1B 02 14 */	add r0, r27, r0
/* 803D3CB8 003CF958  90 1C 00 00 */	stw r0, 0(r28)
/* 803D3CBC 003CF95C  7C 1C 03 78 */	mr r28, r0
/* 803D3CC0 003CF960  7C 1B 02 14 */	add r0, r27, r0
/* 803D3CC4 003CF964  90 1C 00 00 */	stw r0, 0(r28)
/* 803D3CC8 003CF968  7C 1C 03 78 */	mr r28, r0
/* 803D3CCC 003CF96C  7C 1B 02 14 */	add r0, r27, r0
/* 803D3CD0 003CF970  90 1C 00 00 */	stw r0, 0(r28)
/* 803D3CD4 003CF974  7C 1C 03 78 */	mr r28, r0
/* 803D3CD8 003CF978  7C 1B 02 14 */	add r0, r27, r0
/* 803D3CDC 003CF97C  90 1C 00 00 */	stw r0, 0(r28)
/* 803D3CE0 003CF980  7C 1C 03 78 */	mr r28, r0
/* 803D3CE4 003CF984  42 00 FF A0 */	bdnz lbl_803D3C84
/* 803D3CE8 003CF988  70 63 00 07 */	andi. r3, r3, 7
/* 803D3CEC 003CF98C  41 82 00 18 */	beq lbl_803D3D04
lbl_803D3CF0:
/* 803D3CF0 003CF990  7C 69 03 A6 */	mtctr r3
lbl_803D3CF4:
/* 803D3CF4 003CF994  7C 1B E2 14 */	add r0, r27, r28
/* 803D3CF8 003CF998  90 1C 00 00 */	stw r0, 0(r28)
/* 803D3CFC 003CF99C  7C 1C 03 78 */	mr r28, r0
/* 803D3D00 003CF9A0  42 00 FF F4 */	bdnz lbl_803D3CF4
lbl_803D3D04:
/* 803D3D04 003CF9A4  38 00 00 00 */	li r0, 0
/* 803D3D08 003CF9A8  7F E3 FB 78 */	mr r3, r31
/* 803D3D0C 003CF9AC  90 1C 00 00 */	stw r0, 0(r28)
lbl_803D3D10:
/* 803D3D10 003CF9B0  39 61 00 20 */	addi r11, r1, 0x20
/* 803D3D14 003CF9B4  48 03 B6 AD */	bl "_restgpr_27"
/* 803D3D18 003CF9B8  80 01 00 24 */	lwz r0, 0x24(r1)
/* 803D3D1C 003CF9BC  7C 08 03 A6 */	mtlr r0
/* 803D3D20 003CF9C0  38 21 00 20 */	addi r1, r1, 0x20
/* 803D3D24 003CF9C4  4E 80 00 20 */	blr

.global "MEMAllocFromUnitHeap"
"MEMAllocFromUnitHeap":
/* 803D3D28 003CF9C8  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 803D3D2C 003CF9CC  7C 08 02 A6 */	mflr r0
/* 803D3D30 003CF9D0  90 01 00 14 */	stw r0, 0x14(r1)
/* 803D3D34 003CF9D4  93 E1 00 0C */	stw r31, 0xc(r1)
/* 803D3D38 003CF9D8  93 C1 00 08 */	stw r30, 8(r1)
/* 803D3D3C 003CF9DC  7C 7E 1B 78 */	mr r30, r3
/* 803D3D40 003CF9E0  80 03 00 38 */	lwz r0, 0x38(r3)
/* 803D3D44 003CF9E4  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 803D3D48 003CF9E8  41 82 00 0C */	beq lbl_803D3D54
/* 803D3D4C 003CF9EC  38 63 00 20 */	addi r3, r3, 0x20
/* 803D3D50 003CF9F0  48 00 D8 F9 */	bl "OSLockMutex"
lbl_803D3D54:
/* 803D3D54 003CF9F4  83 FE 00 3C */	lwz r31, 0x3c(r30)
/* 803D3D58 003CF9F8  2C 1F 00 00 */	cmpwi r31, 0
/* 803D3D5C 003CF9FC  41 82 00 0C */	beq lbl_803D3D68
/* 803D3D60 003CFA00  80 1F 00 00 */	lwz r0, 0(r31)
/* 803D3D64 003CFA04  90 1E 00 3C */	stw r0, 0x3c(r30)
lbl_803D3D68:
/* 803D3D68 003CFA08  80 1E 00 38 */	lwz r0, 0x38(r30)
/* 803D3D6C 003CFA0C  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 803D3D70 003CFA10  41 82 00 0C */	beq lbl_803D3D7C
/* 803D3D74 003CFA14  38 7E 00 20 */	addi r3, r30, 0x20
/* 803D3D78 003CFA18  48 00 D9 AD */	bl "OSUnlockMutex"
lbl_803D3D7C:
/* 803D3D7C 003CFA1C  2C 1F 00 00 */	cmpwi r31, 0
/* 803D3D80 003CFA20  41 82 00 20 */	beq lbl_803D3DA0
/* 803D3D84 003CFA24  80 1E 00 38 */	lwz r0, 0x38(r30)
/* 803D3D88 003CFA28  80 BE 00 40 */	lwz r5, 0x40(r30)
/* 803D3D8C 003CFA2C  54 00 07 FF */	clrlwi. r0, r0, 0x1f
/* 803D3D90 003CFA30  41 82 00 10 */	beq lbl_803D3DA0
/* 803D3D94 003CFA34  7F E3 FB 78 */	mr r3, r31
/* 803D3D98 003CFA38  38 80 00 00 */	li r4, 0
/* 803D3D9C 003CFA3C  4B C3 06 A1 */	bl "memset"
lbl_803D3DA0:
/* 803D3DA0 003CFA40  7F E3 FB 78 */	mr r3, r31
/* 803D3DA4 003CFA44  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 803D3DA8 003CFA48  83 C1 00 08 */	lwz r30, 8(r1)
/* 803D3DAC 003CFA4C  80 01 00 14 */	lwz r0, 0x14(r1)
/* 803D3DB0 003CFA50  7C 08 03 A6 */	mtlr r0
/* 803D3DB4 003CFA54  38 21 00 10 */	addi r1, r1, 0x10
/* 803D3DB8 003CFA58  4E 80 00 20 */	blr

.global "MEMFreeToUnitHeap"
"MEMFreeToUnitHeap":
/* 803D3DBC 003CFA5C  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 803D3DC0 003CFA60  7C 08 02 A6 */	mflr r0
/* 803D3DC4 003CFA64  2C 04 00 00 */	cmpwi r4, 0
/* 803D3DC8 003CFA68  90 01 00 14 */	stw r0, 0x14(r1)
/* 803D3DCC 003CFA6C  93 E1 00 0C */	stw r31, 0xc(r1)
/* 803D3DD0 003CFA70  7C 9F 23 78 */	mr r31, r4
/* 803D3DD4 003CFA74  93 C1 00 08 */	stw r30, 8(r1)
/* 803D3DD8 003CFA78  7C 7E 1B 78 */	mr r30, r3
/* 803D3DDC 003CFA7C  41 82 00 38 */	beq lbl_803D3E14
/* 803D3DE0 003CFA80  80 03 00 38 */	lwz r0, 0x38(r3)
/* 803D3DE4 003CFA84  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 803D3DE8 003CFA88  41 82 00 0C */	beq lbl_803D3DF4
/* 803D3DEC 003CFA8C  38 63 00 20 */	addi r3, r3, 0x20
/* 803D3DF0 003CFA90  48 00 D8 59 */	bl "OSLockMutex"
lbl_803D3DF4:
/* 803D3DF4 003CFA94  80 1E 00 3C */	lwz r0, 0x3c(r30)
/* 803D3DF8 003CFA98  90 1F 00 00 */	stw r0, 0(r31)
/* 803D3DFC 003CFA9C  80 1E 00 38 */	lwz r0, 0x38(r30)
/* 803D3E00 003CFAA0  93 FE 00 3C */	stw r31, 0x3c(r30)
/* 803D3E04 003CFAA4  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 803D3E08 003CFAA8  41 82 00 0C */	beq lbl_803D3E14
/* 803D3E0C 003CFAAC  38 7E 00 20 */	addi r3, r30, 0x20
/* 803D3E10 003CFAB0  48 00 D9 15 */	bl "OSUnlockMutex"
lbl_803D3E14:
/* 803D3E14 003CFAB4  80 01 00 14 */	lwz r0, 0x14(r1)
/* 803D3E18 003CFAB8  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 803D3E1C 003CFABC  83 C1 00 08 */	lwz r30, 8(r1)
/* 803D3E20 003CFAC0  7C 08 03 A6 */	mtlr r0
/* 803D3E24 003CFAC4  38 21 00 10 */	addi r1, r1, 0x10
/* 803D3E28 003CFAC8  4E 80 00 20 */	blr

.global "MEMCountFreeBlockForUnitHeap"
"MEMCountFreeBlockForUnitHeap":
/* 803D3E2C 003CFACC  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 803D3E30 003CFAD0  7C 08 02 A6 */	mflr r0
/* 803D3E34 003CFAD4  90 01 00 14 */	stw r0, 0x14(r1)
/* 803D3E38 003CFAD8  93 E1 00 0C */	stw r31, 0xc(r1)
/* 803D3E3C 003CFADC  3B E0 00 00 */	li r31, 0
/* 803D3E40 003CFAE0  93 C1 00 08 */	stw r30, 8(r1)
/* 803D3E44 003CFAE4  7C 7E 1B 78 */	mr r30, r3
/* 803D3E48 003CFAE8  80 03 00 38 */	lwz r0, 0x38(r3)
/* 803D3E4C 003CFAEC  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 803D3E50 003CFAF0  41 82 00 0C */	beq lbl_803D3E5C
/* 803D3E54 003CFAF4  38 63 00 20 */	addi r3, r3, 0x20
/* 803D3E58 003CFAF8  48 00 D7 F1 */	bl "OSLockMutex"
lbl_803D3E5C:
/* 803D3E5C 003CFAFC  80 7E 00 3C */	lwz r3, 0x3c(r30)
/* 803D3E60 003CFB00  48 00 00 0C */	b lbl_803D3E6C
lbl_803D3E64:
/* 803D3E64 003CFB04  80 63 00 00 */	lwz r3, 0(r3)
/* 803D3E68 003CFB08  3B FF 00 01 */	addi r31, r31, 1
lbl_803D3E6C:
/* 803D3E6C 003CFB0C  2C 03 00 00 */	cmpwi r3, 0
/* 803D3E70 003CFB10  40 82 FF F4 */	bne lbl_803D3E64
/* 803D3E74 003CFB14  80 1E 00 38 */	lwz r0, 0x38(r30)
/* 803D3E78 003CFB18  54 00 07 7B */	rlwinm. r0, r0, 0, 0x1d, 0x1d
/* 803D3E7C 003CFB1C  41 82 00 0C */	beq lbl_803D3E88
/* 803D3E80 003CFB20  38 7E 00 20 */	addi r3, r30, 0x20
/* 803D3E84 003CFB24  48 00 D8 A1 */	bl "OSUnlockMutex"
lbl_803D3E88:
/* 803D3E88 003CFB28  7F E3 FB 78 */	mr r3, r31
/* 803D3E8C 003CFB2C  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 803D3E90 003CFB30  83 C1 00 08 */	lwz r30, 8(r1)
/* 803D3E94 003CFB34  80 01 00 14 */	lwz r0, 0x14(r1)
/* 803D3E98 003CFB38  7C 08 03 A6 */	mtlr r0
/* 803D3E9C 003CFB3C  38 21 00 10 */	addi r1, r1, 0x10
/* 803D3EA0 003CFB40  4E 80 00 20 */	blr
